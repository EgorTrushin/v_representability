!
! possible choices for sigma_param:
! PBE0_W1, PBE0_W2, PBE0_W3, B3LYP_W1, TPSS_W1, PBE_W1, PBE_P1,
! PBE0_S1,PBE0_S2,PBE_S1,PBE_S2
!
module acfd_sigma
  implicit none
  private
  public :: cubic_spline_integr
contains

  ! integrates cubic spline part of the energy for sigma-functional
  function cubic_spline_integr(s) result(integral)
    use acfd_parameters, only: sigma_param
    use iso_fortran_env, only: dp => real64
    implicit none

    integer :: n
    integer :: m, i
    real(dp), intent(in) :: s
    real(dp), allocatable :: x(:), c(:, :)
    real(dp) :: h
    real(dp) :: integral

    n=-999 ! to suppress -Wmaybe-uninitialized warning

    if (trim(sigma_param) == 'PBE0_W1') then
      n = 22
      allocate (x(n))
      allocate (c(4, n))

      ! coefficients for PBE0_W1
      c(1, 1) = 0.000000000000D+00
      c(1, 2) = 0.000000000000D+00
      c(1, 3) = -0.163594103590D-03
      c(1, 4) = -0.679644651516D-03
      c(1, 5) = -0.206305566905D-02
      c(1, 6) = -0.538487736264D-02
      c(1, 7) = -0.103458407350D-01
      c(1, 8) = -0.168414630497D-01
      c(1, 9) = -0.204773827189D-01
      c(1, 10) = -0.136547635644D-01
      c(1, 11) = -0.615544718661D-02
      c(1, 12) = -0.734864625150D-01
      c(1, 13) = 0.824090490068D-02
      c(1, 14) = 0.117940542727D+00
      c(1, 15) = 0.149367614907D+00
      c(1, 16) = -0.403837739134D-01
      c(1, 17) = -0.566051777937D-02
      c(1, 18) = 0.552374300000D-01
      c(1, 19) = 0.392254426171D-01
      c(1, 20) = 0.899646367376D-01
      c(1, 21) = 0.000000000000D+00
      c(1, 22) = 0.000000000000D+00
      c(2, 1) = 0.000000000000D+00
      c(2, 2) = 0.000000000000D+00
      c(2, 3) = -0.254025083646D+01
      c(2, 4) = -0.489179427394D+01
      c(2, 5) = -0.582500502360D+01
      c(2, 6) = -0.628017499439D+01
      c(2, 7) = -0.548395066840D+01
      c(2, 8) = -0.236224992800D+01
      c(2, 9) = 0.000000000000D+00
      c(2, 10) = 0.121782248423D+01
      c(2, 11) = 0.000000000000D+00
      c(2, 12) = 0.000000000000D+00
      c(2, 13) = 0.289449672543D+01
      c(2, 14) = 0.745869971141D+00
      c(2, 15) = 0.000000000000D+00
      c(2, 16) = 0.000000000000D+00
      c(2, 17) = 0.140199554463D+00
      c(2, 18) = 0.000000000000D+00
      c(2, 19) = 0.000000000000D+00
      c(2, 20) = 0.000000000000D+00
      c(2, 21) = 0.000000000000D+00
      c(2, 22) = 0.000000000000D+00
      c(3, 1) = -0.000000000000D+00
      c(3, 2) = -0.323653994429D+05
      c(3, 3) = -0.297823525233D+05
      c(3, 4) = -0.433459468098D+04
      c(3, 5) = -0.124591667249D+04
      c(3, 6) = -0.138576248969D+04
      c(3, 7) = -0.541888483103D+03
      c(3, 8) = 0.118846515312D+03
      c(3, 9) = 0.790307372330D+03
      c(3, 10) = 0.584731002077D+02
      c(3, 11) = -0.105454553280D+04
      c(3, 12) = 0.287170551613D+03
      c(3, 13) = 0.224985882000D+02
      c(3, 14) = -0.360197342952D+01
      c(3, 15) = -0.297190646015D+02
      c(3, 16) = 0.115011706043D+01
      c(3, 17) = 0.313110259185D+00
      c(3, 18) = -0.793040582103D-01
      c(3, 19) = 0.219961027743D+00
      c(3, 20) = -0.494222698634D-02
      c(3, 21) = -0.000000000000D+00
      c(3, 22) = 0.000000000000D+00
      c(4, 1) = 0.000000000000D+00
      c(4, 2) = 0.135206628118D+09
      c(4, 3) = 0.113172424280D+09
      c(4, 4) = 0.658995031995D+07
      c(4, 5) = 0.102168583769D+07
      c(4, 6) = 0.162520130715D+07
      c(4, 7) = 0.804274604886D+06
      c(4, 8) = 0.978041865691D+05
      c(4, 9) = -0.991911668821D+05
      c(4, 10) = -0.117105524995D+05
      c(4, 11) = 0.507970552129D+05
      c(4, 12) = -0.618593746028D+04
      c(4, 13) = -0.716622677854D+03
      c(4, 14) = -0.101918364203D+02
      c(4, 15) = 0.143155598169D+03
      c(4, 16) = -0.234387763193D+01
      c(4, 17) = -0.720927451920D+00
      c(4, 18) = 0.679310944898D-01
      c(4, 19) = -0.176276712036D+00
      c(4, 20) = 0.445857657461D-03
      c(4, 21) = 0.000000000000D+00
      c(4, 22) = 0.000000000000D+00
      x(1) = 0.000000000000D+00
      x(2) = 0.100000000000D-04
      x(3) = 0.100000000000D-03
      x(4) = 0.215443469000D-03
      x(5) = 0.464158883000D-03
      x(6) = 0.100000000000D-02
      x(7) = 0.177827941000D-02
      x(8) = 0.316227766000D-02
      x(9) = 0.562341325000D-02
      x(10) = 0.100000000000D-01
      x(11) = 0.177827941000D-01
      x(12) = 0.316227766000D-01
      x(13) = 0.562341325000D-01
      x(14) = 0.100000000000D+00
      x(15) = 0.177827941000D+00
      x(16) = 0.316227766000D+00
      x(17) = 0.562341325000D+00
      x(18) = 0.100000000000D+01
      x(19) = 0.177827941000D+01
      x(20) = 0.261015722000D+01
      x(21) = 0.100000000000D+02
      x(22) = 0.215443469000D+02

    elseif (trim(sigma_param) == 'PBE0_W2') then
      n = 22
      allocate (x(n))
      allocate (c(4, n))

      ! coefficients for PBE0_W2
      c(1, 1) = 0.000000000000D+00
      c(1, 2) = 0.000000000000D+00
      c(1, 3) = -0.155254420558D-03
      c(1, 4) = -0.648947709550D-03
      c(1, 5) = -0.198615142294D-02
      c(1, 6) = -0.516543783217D-02
      c(1, 7) = -0.976340668425D-02
      c(1, 8) = -0.155019712854D-01
      c(1, 9) = -0.183159814988D-01
      c(1, 10) = -0.123715075248D-01
      c(1, 11) = -0.119942071238D-01
      c(1, 12) = -0.776734013419D-01
      c(1, 13) = -0.270464211619D-01
      c(1, 14) = 0.158972501818D+00
      c(1, 15) = 0.114510414969D+00
      c(1, 16) = 0.612616026148D-02
      c(1, 17) = -0.313160654997D-01
      c(1, 18) = 0.625587550000D-01
      c(1, 19) = 0.526770806561D-01
      c(1, 20) = 0.874274502765D-01
      c(1, 21) = 0.000000000000D+00
      c(1, 22) = 0.000000000000D+00
      c(2, 1) = 0.000000000000D+00
      c(2, 2) = 0.000000000000D+00
      c(2, 3) = -0.241601976347D+01
      c(2, 4) = -0.469848559044D+01
      c(2, 5) = -0.560746578835D+01
      c(2, 6) = -0.592131742389D+01
      c(2, 7) = -0.495385146940D+01
      c(2, 8) = -0.189281266950D+01
      c(2, 9) = 0.000000000000D+00
      c(2, 10) = 0.102530253188D+00
      c(2, 11) = 0.000000000000D+00
      c(2, 12) = 0.000000000000D+00
      c(2, 13) = 0.268517058258D+01
      c(2, 14) = 0.000000000000D+00
      c(2, 15) = -0.651129829644D+00
      c(2, 16) = -0.271903582295D+00
      c(2, 17) = 0.000000000000D+00
      c(2, 18) = 0.000000000000D+00
      c(2, 19) = 0.000000000000D+00
      c(2, 20) = 0.000000000000D+00
      c(2, 21) = 0.000000000000D+00
      c(2, 22) = 0.000000000000D+00
      c(3, 1) = -0.000000000000D+00
      c(3, 2) = -0.306569732051D+05
      c(3, 3) = -0.285763808010D+05
      c(3, 4) = -0.452278200715D+04
      c(3, 5) = -0.123831624512D+04
      c(3, 6) = -0.119122445527D+04
      c(3, 7) = -0.461406102591D+03
      c(3, 8) = 0.144441043509D+03
      c(3, 9) = 0.907602853862D+03
      c(3, 10) = -0.766102134665D+01
      c(3, 11) = -0.102867453465D+04
      c(3, 12) = 0.141642039379D+03
      c(3, 13) = 0.168638666521D+03
      c(3, 14) = -0.136548776622D+02
      c(3, 15) = -0.560123115797D+01
      c(3, 16) = 0.355142320335D+00
      c(3, 17) = 0.147027743474D+01
      c(3, 18) = -0.489418870153D-01
      c(3, 19) = 0.150647387067D+00
      c(3, 20) = -0.480284609345D-02
      c(3, 21) = -0.000000000000D+00
      c(3, 22) = 0.000000000000D+00
      c(4, 1) = 0.000000000000D+00
      c(4, 2) = 0.127664008784D+09
      c(4, 3) = 0.107935875627D+09
      c(4, 4) = 0.722494306606D+07
      c(4, 5) = 0.117629070359D+07
      c(4, 6) = 0.155279793223D+07
      c(4, 7) = 0.754949952365D+06
      c(4, 8) = 0.650375832961D+05
      c(4, 9) = -0.136466979122D+06
      c(4, 10) = 0.920011573066D+02
      c(4, 11) = 0.495508591213D+05
      c(4, 12) = -0.235908941182D+04
      c(4, 13) = -0.303608292284D+04
      c(4, 14) = 0.811340234135D+02
      c(4, 15) = 0.335803406836D+02
      c(4, 16) = 0.534312264963D+00
      c(4, 17) = -0.223961048297D+01
      c(4, 18) = 0.419231502950D-01
      c(4, 19) = -0.120728777918D+00
      c(4, 20) = 0.433283561092D-03
      c(4, 21) = 0.000000000000D+00
      c(4, 22) = 0.000000000000D+00
      x(1) = 0.000000000000D+00
      x(2) = 0.100000000000D-04
      x(3) = 0.100000000000D-03
      x(4) = 0.215443469000D-03
      x(5) = 0.464158883000D-03
      x(6) = 0.100000000000D-02
      x(7) = 0.177827941000D-02
      x(8) = 0.316227766000D-02
      x(9) = 0.562341325000D-02
      x(10) = 0.100000000000D-01
      x(11) = 0.177827941000D-01
      x(12) = 0.316227766000D-01
      x(13) = 0.562341325000D-01
      x(14) = 0.100000000000D+00
      x(15) = 0.177827941000D+00
      x(16) = 0.316227766000D+00
      x(17) = 0.562341325000D+00
      x(18) = 0.100000000000D+01
      x(19) = 0.177827941000D+01
      x(20) = 0.261015722000D+01
      x(21) = 0.100000000000D+02
      x(22) = 0.215443469000D+02

    elseif (trim(sigma_param) == 'PBE0_W3') then
      n = 22
      allocate (x(n))
      allocate (c(4, n))

      ! coefficients for PBE0_W3
      c(1, 1) = 0.000000000000D+00
      c(1, 2) = 0.000000000000D+00
      c(1, 3) = -0.155505547445D-03
      c(1, 4) = -0.639158850009D-03
      c(1, 5) = -0.190226098512D-02
      c(1, 6) = -0.481770154845D-02
      c(1, 7) = -0.893837846565D-02
      c(1, 8) = -0.147466527237D-01
      c(1, 9) = -0.207561523547D-01
      c(1, 10) = -0.214104970297D-01
      c(1, 11) = -0.570244652323D-02
      c(1, 12) = 0.318406435059D-01
      c(1, 13) = 0.523437202383D-01
      c(1, 14) = 0.557364536364D-01
      c(1, 15) = 0.879397053810D-01
      c(1, 16) = -0.870763797076D-01
      c(1, 17) = -0.877736771421D-02
      c(1, 18) = 0.462748000000D-01
      c(1, 19) = 0.596543140072D-01
      c(1, 20) = 0.131493263782D+00
      c(1, 21) = 0.000000000000D+00
      c(1, 22) = 0.000000000000D+00
      c(2, 1) = 0.000000000000D+00
      c(2, 2) = 0.000000000000D+00
      c(2, 3) = -0.240533000431D+01
      c(2, 4) = -0.453827614100D+01
      c(2, 5) = -0.523146048235D+01
      c(2, 6) = -0.537123694121D+01
      c(2, 7) = -0.473329566266D+01
      c(2, 8) = -0.316541050151D+01
      c(2, 9) = -0.307137763953D+00
      c(2, 10) = 0.000000000000D+00
      c(2, 11) = 0.228323483546D+01
      c(2, 12) = 0.134106492283D+01
      c(2, 13) = 0.153753941899D+00
      c(2, 14) = 0.122733007844D+00
      c(2, 15) = 0.000000000000D+00
      c(2, 16) = 0.000000000000D+00
      c(2, 17) = 0.187893732791D+00
      c(2, 18) = 0.325573640552D-01
      c(2, 19) = 0.284631881107D-01
      c(2, 20) = 0.000000000000D+00
      c(2, 21) = 0.000000000000D+00
      c(2, 22) = 0.000000000000D+00
      c(3, 1) = -0.000000000000D+00
      c(3, 2) = -0.308687582651D+05
      c(3, 3) = -0.278893120491D+05
      c(3, 4) = -0.372915428973D+04
      c(3, 5) = -0.911547898783D+03
      c(3, 6) = -0.524266276288D+03
      c(3, 7) = 0.301994901456D+02
      c(3, 8) = -0.279268567715D+03
      c(3, 9) = 0.378707704538D+02
      c(3, 10) = 0.484617663728D+03
      c(3, 11) = 0.161158349535D+03
      c(3, 12) = -0.136791436105D+02
      c(3, 13) = -0.451677696210D+01
      c(3, 14) = 0.127956463503D+02
      c(3, 15) = -0.274112056379D+02
      c(3, 16) = 0.311454471066D+01
      c(3, 17) = -0.707883042725D-01
      c(3, 18) = -0.539709535904D-01
      c(3, 19) = 0.243000046655D+00
      c(3, 20) = -0.722361119162D-02
      c(3, 21) = -0.000000000000D+00
      c(3, 22) = 0.000000000000D+00
      c(4, 1) = 0.000000000000D+00
      c(4, 2) = 0.129672694791D+09
      c(4, 3) = 0.107707882907D+09
      c(4, 4) = 0.626050241521D+07
      c(4, 5) = 0.971831294239D+06
      c(4, 6) = 0.800147130344D+06
      c(4, 7) = 0.258301736291D+06
      c(4, 8) = 0.232941318959D+06
      c(4, 9) = -0.423775887060D+03
      c(4, 10) = -0.289470064599D+05
      c(4, 11) = -0.940253226207D+04
      c(4, 12) = -0.282852045112D+03
      c(4, 13) = 0.634037553882D+02
      c(4, 14) = -0.116360401698D+03
      c(4, 15) = 0.132038729760D+03
      c(4, 16) = -0.740260743041D+01
      c(4, 17) = -0.162492854382D+00
      c(4, 18) = 0.439779331098D-01
      c(4, 19) = -0.208450357610D+00
      c(4, 20) = 0.651670263872D-03
      c(4, 21) = 0.000000000000D+00
      c(4, 22) = 0.000000000000D+00
      x(1) = 0.000000000000D+00
      x(2) = 0.100000000000D-04
      x(3) = 0.100000000000D-03
      x(4) = 0.215443469000D-03
      x(5) = 0.464158883000D-03
      x(6) = 0.100000000000D-02
      x(7) = 0.177827941000D-02
      x(8) = 0.316227766000D-02
      x(9) = 0.562341325000D-02
      x(10) = 0.100000000000D-01
      x(11) = 0.177827941000D-01
      x(12) = 0.316227766000D-01
      x(13) = 0.562341325000D-01
      x(14) = 0.100000000000D+00
      x(15) = 0.177827941000D+00
      x(16) = 0.316227766000D+00
      x(17) = 0.562341325000D+00
      x(18) = 0.100000000000D+01
      x(19) = 0.177827941000D+01
      x(20) = 0.261015722000D+01
      x(21) = 0.100000000000D+02
      x(22) = 0.215443469000D+02

    elseif (trim(sigma_param) == 'B3LYP_W1') then
      n = 22
      allocate (x(n))
      allocate (c(4, n))

      ! coefficients for B3LYP_W1
      c(1, 1) = 0.000000000000D+00
      c(1, 2) = 0.000000000000D+00
      c(1, 3) = -0.137219924008D-03
      c(1, 4) = -0.564174402221D-03
      c(1, 5) = -0.169526007170D-02
      c(1, 6) = -0.445126004995D-02
      c(1, 7) = -0.881950690944D-02
      c(1, 8) = -0.152445457422D-01
      c(1, 9) = -0.209493408452D-01
      c(1, 10) = -0.208768163366D-01
      c(1, 11) = -0.208621661135D-01
      c(1, 12) = -0.825623625710D-01
      c(1, 13) = 0.390526593565D-01
      c(1, 14) = 0.152691916364D+00
      c(1, 15) = 0.120069723833D+00
      c(1, 16) = -0.114296675720D-01
      c(1, 17) = -0.343949422920D-01
      c(1, 18) = 0.462038200000D-01
      c(1, 19) = 0.326800355187D-01
      c(1, 20) = 0.610967959278D-01
      c(1, 21) = 0.000000000000D+00
      c(1, 22) = 0.000000000000D+00
      c(2, 1) = 0.000000000000D+00
      c(2, 2) = 0.000000000000D+00
      c(2, 3) = -0.212272836088D+01
      c(2, 4) = -0.402868977780D+01
      c(2, 5) = -0.479128762008D+01
      c(2, 6) = -0.535339840091D+01
      c(2, 7) = -0.512692821021D+01
      c(2, 8) = -0.319156353876D+01
      c(2, 9) = 0.000000000000D+00
      c(2, 10) = 0.365219141770D-02
      c(2, 11) = 0.000000000000D+00
      c(2, 12) = 0.000000000000D+00
      c(2, 13) = 0.350609352998D+01
      c(2, 14) = 0.000000000000D+00
      c(2, 15) = -0.561370960807D+00
      c(2, 16) = -0.184046397209D+00
      c(2, 17) = 0.000000000000D+00
      c(2, 18) = 0.000000000000D+00
      c(2, 19) = 0.000000000000D+00
      c(2, 20) = 0.000000000000D+00
      c(2, 21) = 0.000000000000D+00
      c(2, 22) = 0.000000000000D+00
      c(3, 1) = -0.000000000000D+00
      c(3, 2) = -0.272363234004D+05
      c(3, 3) = -0.244362951908D+05
      c(3, 4) = -0.319426908947D+04
      c(3, 5) = -0.921864998465D+03
      c(3, 6) = -0.129049711906D+04
      c(3, 7) = -0.348053147786D+03
      c(3, 8) = -0.231897043984D+03
      c(3, 9) = 0.105243818063D+02
      c(3, 10) = -0.212934407670D+00
      c(3, 11) = -0.966355047960D+03
      c(3, 12) = 0.459875658562D+03
      c(3, 13) = 0.177625626878D+02
      c(3, 14) = -0.894412192522D+01
      c(3, 15) = -0.111534506587D+02
      c(3, 16) = 0.358199252047D+00
      c(3, 17) = 0.126234639741D+01
      c(3, 18) = -0.669805044232D-01
      c(3, 19) = 0.123190364630D+00
      c(3, 20) = -0.335636584066D-02
      c(3, 21) = -0.000000000000D+00
      c(3, 22) = 0.000000000000D+00
      c(4, 1) = 0.000000000000D+00
      c(4, 2) = 0.114395467127D+09
      c(4, 3) = 0.934445216758D+08
      c(4, 4) = 0.445273554761D+07
      c(4, 5) = 0.494366005567D+06
      c(4, 6) = 0.123005632087D+07
      c(4, 7) = 0.504454621957D+06
      c(4, 8) = 0.238450768157D+06
      c(4, 9) = -0.153957721034D+04
      c(4, 10) = -0.185862973587D+01
      c(4, 11) = 0.465489532693D+05
      c(4, 12) = -0.105275650660D+05
      c(4, 13) = -0.880711825842D+03
      c(4, 14) = 0.457216655248D+02
      c(4, 15) = 0.602920760359D+02
      c(4, 16) = 0.425445558964D-01
      c(4, 17) = -0.192287806232D+01
      c(4, 18) = 0.573748566925D-01
      c(4, 19) = -0.987247270764D-01
      c(4, 20) = 0.302790910946D-03
      c(4, 21) = 0.000000000000D+00
      c(4, 22) = 0.000000000000D+00
      x(1) = 0.000000000000D+00
      x(2) = 0.100000000000D-04
      x(3) = 0.100000000000D-03
      x(4) = 0.215443469000D-03
      x(5) = 0.464158883000D-03
      x(6) = 0.100000000000D-02
      x(7) = 0.177827941000D-02
      x(8) = 0.316227766000D-02
      x(9) = 0.562341325000D-02
      x(10) = 0.100000000000D-01
      x(11) = 0.177827941000D-01
      x(12) = 0.316227766000D-01
      x(13) = 0.562341325000D-01
      x(14) = 0.100000000000D+00
      x(15) = 0.177827941000D+00
      x(16) = 0.316227766000D+00
      x(17) = 0.562341325000D+00
      x(18) = 0.100000000000D+01
      x(19) = 0.177827941000D+01
      x(20) = 0.261015722000D+01
      x(21) = 0.100000000000D+02
      x(22) = 0.215443469000D+02

    elseif (trim(sigma_param) == 'TPSS_W1') then
      n = 23
      allocate (x(n))
      allocate (c(4, n))

      ! coefficients for TPSS_W1
      c(1, 1) = 0.000000000000D+00
      c(1, 2) = 0.000000000000D+00
      c(1, 3) = 0.146798731127D-03
      c(1, 4) = 0.574878906062D-03
      c(1, 5) = 0.154055131096D-02
      c(1, 6) = 0.314892637363D-02
      c(1, 7) = 0.361072227263D-02
      c(1, 8) = 0.735868971744D-03
      c(1, 9) = -0.901096557066D-02
      c(1, 10) = -0.307032486139D-01
      c(1, 11) = -0.682643373448D-01
      c(1, 12) = -0.891052789694D-01
      c(1, 13) = 0.994712453012D-01
      c(1, 14) = 0.205360100000D+00
      c(1, 15) = 0.513852204369D-01
      c(1, 16) = 0.632811675468D-01
      c(1, 17) = -0.890738739423D-01
      c(1, 18) = -0.690380950000D-01
      c(1, 19) = 0.272741297389D-02
      c(1, 20) = -0.472452045191D-01
      c(1, 21) = 0.265078785377D-01
      c(1, 22) = 0.000000000000D+00
      c(1, 23) = 0.000000000000D+00
      c(2, 1) = 0.000000000000D+00
      c(2, 2) = 0.000000000000D+00
      c(2, 3) = 0.222980820374D+01
      c(2, 4) = 0.378277406131D+01
      c(2, 5) = 0.343943397868D+01
      c(2, 6) = 0.103341235903D+01
      c(2, 7) = 0.000000000000D+00
      c(2, 8) = -0.264796787242D+01
      c(2, 9) = -0.435727350647D+01
      c(2, 10) = -0.489652548865D+01
      c(2, 11) = -0.241365453601D+01
      c(2, 12) = 0.000000000000D+00
      c(2, 13) = 0.386531297928D+01
      c(2, 14) = 0.000000000000D+00
      c(2, 15) = 0.000000000000D+00
      c(2, 16) = 0.000000000000D+00
      c(2, 17) = 0.000000000000D+00
      c(2, 18) = 0.593195958219D-01
      c(2, 19) = 0.000000000000D+00
      c(2, 20) = 0.000000000000D+00
      c(2, 21) = 0.000000000000D+00
      c(2, 22) = 0.000000000000D+00
      c(2, 23) = 0.000000000000D+00
      c(3, 1) = -0.000000000000D+00
      c(3, 2) = 0.295942537092D+05
      c(3, 3) = 0.249647722458D+05
      c(3, 4) = 0.258503390026D+04
      c(3, 5) = 0.203882849848D+04
      c(3, 6) = -0.368453827753D+03
      c(3, 7) = -0.258935185354D+04
      c(3, 8) = -0.905147145166D+03
      c(3, 9) = -0.287494126008D+03
      c(3, 10) = -0.291900950983D+03
      c(3, 11) = 0.223814018522D+02
      c(3, 12) = 0.776926436706D+03
      c(3, 13) = -0.107917068055D+02
      c(3, 14) = -0.762605697829D+02
      c(3, 15) = 0.186315590548D+01
      c(3, 16) = -0.754582976226D+01
      c(3, 17) = 0.178264013546D+00
      c(3, 18) = 0.203001913958D+00
      c(3, 19) = -0.782676457237D-01
      c(3, 20) = 0.365283750212D-01
      c(3, 21) = -0.832121965427D-03
      c(3, 22) = -0.000000000000D+00
      c(3, 23) = 0.000000000000D+00
      c(4, 1) = 0.000000000000D+00
      c(4, 2) = -0.127455039668D+09
      c(4, 3) = -0.105325341933D+09
      c(4, 4) = -0.877913873670D+07
      c(4, 5) = -0.532983504783D+07
      c(4, 6) = -0.253083484333D+06
      c(4, 7) = 0.786472503057D+06
      c(4, 8) = 0.151119292450D+06
      c(4, 9) = 0.344084990927D+05
      c(4, 10) = 0.386674503442D+05
      c(4, 11) = 0.312222024991D+04
      c(4, 12) = -0.189180804017D+05
      c(4, 13) = -0.508269491627D+03
      c(4, 14) = 0.653240715379D+03
      c(4, 15) = -0.897475077723D+01
      c(4, 16) = 0.204399676120D+02
      c(4, 17) = -0.168311936520D+00
      c(4, 18) = -0.206533675729D+00
      c(4, 19) = 0.377012257656D-01
      c(4, 20) = -0.989472100322D-02
      c(4, 21) = 0.567467647949D-04
      c(4, 22) = 0.000000000000D+00
      c(4, 23) = 0.000000000000D+00
      x(1) = 0.000000000000D+00
      x(2) = 0.100000000000D-04
      x(3) = 0.100000000000D-03
      x(4) = 0.215443469000D-03
      x(5) = 0.464158883000D-03
      x(6) = 0.100000000000D-02
      x(7) = 0.177827941000D-02
      x(8) = 0.316227766000D-02
      x(9) = 0.562341325000D-02
      x(10) = 0.100000000000D-01
      x(11) = 0.177827941000D-01
      x(12) = 0.316227766000D-01
      x(13) = 0.562341325000D-01
      x(14) = 0.100000000000D+00
      x(15) = 0.177827941000D+00
      x(16) = 0.316227766000D+00
      x(17) = 0.562341325000D+00
      x(18) = 0.100000000000D+01
      x(19) = 0.177827941000D+01
      x(20) = 0.316227766000D+01
      x(21) = 0.562341325000D+01
      x(22) = 0.153992653000D+02
      x(23) = 0.316227766000D+02

    elseif (trim(sigma_param) == 'PBE_W1') then
      n = 23
      allocate (x(n))
      allocate (c(4, n))

      ! coefficients for PBE_W1
      c(1, 1) = 0.000000000000D+00
      c(1, 2) = 0.000000000000D+00
      c(1, 3) = 0.146841795820D-04
      c(1, 4) = 0.355947222380D-04
      c(1, 5) = -0.371192689381D-04
      c(1, 6) = -0.641360939061D-03
      c(1, 7) = -0.255216217181D-02
      c(1, 8) = -0.670235407381D-02
      c(1, 9) = -0.134545320809D-01
      c(1, 10) = -0.242715093069D-01
      c(1, 11) = -0.461787575633D-01
      c(1, 12) = -0.896767885692D-01
      c(1, 13) = 0.342837410852D-01
      c(1, 14) = 0.224951854545D+00
      c(1, 15) = 0.124376029194D+00
      c(1, 16) = 0.564118372586D-01
      c(1, 17) = -0.101942856761D+00
      c(1, 18) = -0.161339200000D-01
      c(1, 19) = -0.127751725427D-01
      c(1, 20) = -0.153560580635D-01
      c(1, 21) = -0.290083965652D-01
      c(1, 22) = 0.000000000000D+00
      c(1, 23) = 0.000000000000D+00
      c(2, 1) = 0.000000000000D+00
      c(2, 2) = 0.000000000000D+00
      c(2, 3) = 0.171306505377D+00
      c(2, 4) = 0.000000000000D+00
      c(2, 5) = -0.433243270713D+00
      c(2, 6) = -0.151104029702D+01
      c(2, 7) = -0.267495140333D+01
      c(2, 8) = -0.287737928116D+01
      c(2, 9) = -0.261317200560D+01
      c(2, 10) = -0.261618455996D+01
      c(2, 11) = -0.295465031755D+01
      c(2, 12) = 0.000000000000D+00
      c(2, 13) = 0.470381335331D+01
      c(2, 14) = 0.000000000000D+00
      c(2, 15) = -0.742860478947D+00
      c(2, 16) = -0.550118664559D+00
      c(2, 17) = 0.000000000000D+00
      c(2, 18) = 0.927399359423D-02
      c(2, 19) = 0.000000000000D+00
      c(2, 20) = -0.266751515726D-02
      c(2, 21) = 0.000000000000D+00
      c(2, 22) = 0.000000000000D+00
      c(2, 23) = 0.000000000000D+00
      c(3, 1) = -0.000000000000D+00
      c(3, 2) = 0.353517941509D+04
      c(3, 3) = 0.173924027457D+04
      c(3, 4) = -0.178449468530D+04
      c(3, 5) = -0.187635021369D+04
      c(3, 6) = -0.214376854534D+04
      c(3, 7) = -0.555499257099D+03
      c(3, 8) = 0.558142973786D+02
      c(3, 9) = 0.977615610264D+02
      c(3, 10) = -0.330823157893D+02
      c(3, 11) = -0.254297665006D+03
      c(3, 12) = 0.422827139998D+03
      c(3, 13) = 0.836729225790D+02
      c(3, 14) = -0.402682166060D+02
      c(3, 15) = 0.406521833899D+01
      c(3, 16) = -0.337253431809D+01
      c(3, 17) = 0.132275869041D+01
      c(3, 18) = -0.719686076381D-02
      c(3, 19) = -0.211481260710D-02
      c(3, 20) = -0.459400974873D-02
      c(3, 21) = 0.910616967308D-03
      c(3, 22) = -0.000000000000D+00
      c(3, 23) = 0.000000000000D+00
      c(4, 1) = 0.000000000000D+00
      c(4, 2) = -0.191368637588D+08
      c(4, 3) = -0.143284561334D+08
      c(4, 4) = 0.244866968670D+07
      c(4, 5) = 0.108321216548D+07
      c(4, 6) = 0.119581924119D+07
      c(4, 7) = 0.232354680061D+06
      c(4, 8) = -0.579247398297D+03
      c(4, 9) = -0.149440243023D+05
      c(4, 10) = 0.971187372896D+03
      c(4, 11) = 0.173912044223D+05
      c(4, 12) = -0.886488584944D+04
      c(4, 13) = -0.209312731864D+04
      c(4, 14) = 0.304053296034D+03
      c(4, 15) = -0.162278426521D+02
      c(4, 16) = 0.121628021074D+02
      c(4, 17) = -0.199876259469D+01
      c(4, 18) = 0.106118734554D-02
      c(4, 19) = 0.554487076904D-03
      c(4, 20) = 0.139121075690D-02
      c(4, 21) = -0.620997510090D-04
      c(4, 22) = 0.000000000000D+00
      c(4, 23) = 0.000000000000D+00
      x(1) = 0.000000000000D+00
      x(2) = 0.100000000000D-04
      x(3) = 0.100000000000D-03
      x(4) = 0.215443469000D-03
      x(5) = 0.464158883000D-03
      x(6) = 0.100000000000D-02
      x(7) = 0.177827941000D-02
      x(8) = 0.316227766000D-02
      x(9) = 0.562341325000D-02
      x(10) = 0.100000000000D-01
      x(11) = 0.177827941000D-01
      x(12) = 0.316227766000D-01
      x(13) = 0.562341325000D-01
      x(14) = 0.100000000000D+00
      x(15) = 0.177827941000D+00
      x(16) = 0.316227766000D+00
      x(17) = 0.562341325000D+00
      x(18) = 0.100000000000D+01
      x(19) = 0.177827941000D+01
      x(20) = 0.316227766000D+01
      x(21) = 0.562341325000D+01
      x(22) = 0.153992653000D+02
      x(23) = 0.316227766000D+02

    elseif (trim(sigma_param) == 'PBE_P1') then
      n = 13
      allocate (x(n))
      allocate (c(4, n))

      ! old parametrization for PBE (J.Chem.Phys 154,014104, 2021)
      c(1, 1) = 0d0
      c(1, 2) = -5.885072220000d-05
      c(1, 3) = -6.644982900000d-04
      c(1, 4) = -1.180579200000d-02
      c(1, 5) = -1.570844509420d-02
      c(1, 6) = 1.760985050000d-01
      c(1, 7) = 9.814551470161d-02
      c(1, 8) = -3.628324496584d-02
      c(1, 9) = -4.247178370737d-02
      c(1, 10) = -4.944074770000d-02
      c(1, 11) = -9.490347223423d-03
      c(1, 12) = 4.773528498951d-03
      c(1, 13) = 0d0
      c(2, 1) = -5.885072220000d-01
      c(2, 2) = -5.885072220000d-01
      c(2, 3) = -7.606856690986d-01
      c(2, 4) = -1.281859889831d+00
      c(2, 5) = 1.086808331529d+00
      c(2, 6) = 1.709528474395d+00
      c(2, 7) = -1.974002322512d+00
      c(2, 8) = -3.286910860598d-01
      c(2, 9) = 7.951658597067d-02
      c(2, 10) = -3.924864826146d-02
      c(2, 11) = 5.362175675285d-02
      c(2, 12) = -1.285966486385d-02
      c(2, 13) = 0d0
      c(3, 1) = 0d0
      c(3, 2) = -9.013901433489d+01
      c(3, 3) = -1.011703713302d+02
      c(3, 4) = 4.326212458218d+01
      c(3, 5) = 6.628292899688d+01
      c(3, 6) = -5.717580074689d+01
      c(3, 7) = 9.846644284656d+00
      c(3, 8) = 2.041457714737d+00
      c(3, 9) = -3.828425884461d-01
      c(3, 10) = 1.114776159963d-01
      c(3, 11) = -3.103096464721d-02
      c(3, 12) = 4.301048534742d-03
      c(3, 13) = 0d0
      c(4, 1) = 0d0
      c(4, 2) = -4.085687776044d+03
      c(4, 3) = 5.349351700459d+03
      c(4, 4) = 3.548851108681d+02
      c(4, 5) = -6.018511409108d+02
      c(4, 6) = 2.870539130593d+02
      c(4, 7) = -1.879864267456d+01
      c(4, 8) = -3.283444048247d+00
      c(4, 9) = 3.764883708805d-01
      c(4, 10) = -4.114815729697d-02
      c(4, 11) = 4.735266512417d-03
      c(4, 12) = -3.858229788514d-04
      c(4, 13) = 0d0

      x(1) = 0d0
      x(2) = 1.000000000000d-04
      x(3) = 1.000000000000d-03
      x(4) = 1.000000000000d-02
      x(5) = 3.162277660168d-02
      x(6) = 1.000000000000d-01
      x(7) = 1.778279410039d-01
      x(8) = 3.162277660168d-01
      x(9) = 5.623413251903d-01
      x(10) = 1.000000000000d+00
      x(11) = 2.154434690032d+00
      x(12) = 4.641588833613d+00
      x(13) = 1.000000000000d+01

    elseif (trim(sigma_param) == 'PBE0_S1') then
      n = 21
      allocate (x(n))
      allocate (c(4, n))

      c(1, 1) = 0.000000000000D+00
      c(1, 2) = 0.000000000000D+00
      c(1, 3) = -0.149500660756D-03
      c(1, 4) = -0.353017276233D-02
      c(1, 5) = -0.109810247734D-01
      c(1, 6) = -0.231246943777D-01
      c(1, 7) = -0.268999962858D-01
      c(1, 8) = -0.634751994007D-03
      c(1, 9) = 0.118792892470D-01
      c(1, 10) = -0.473431931326D-01
      c(1, 11) = -0.817589390539D-01
      c(1, 12) = 0.125726011069D-01
      c(1, 13) = 0.108028492092D+00
      c(1, 14) = 0.193548206759D+00
      c(1, 15) = 0.358395561305D-01
      c(1, 16) = -0.497714974829D-01
      c(1, 17) = 0.341059348835D-01
      c(1, 18) = 0.341050720155D-01
      c(1, 19) = 0.785549033229D-01
      c(1, 20) = 0.000000000000D+00
      c(1, 21) = 0.000000000000D+00
      c(2, 1) = 0.000000000000D+00
      c(2, 2) = 0.000000000000D+00
      c(2, 3) = -0.208376539581D+01
      c(2, 4) = -0.469755869285D+01
      c(2, 5) = -0.565503803415D+01
      c(2, 6) = -0.135502867642D+01
      c(2, 7) = 0.000000000000D+00
      c(2, 8) = 0.284340701746D+01
      c(2, 9) = 0.000000000000D+00
      c(2, 10) = -0.342695931351D+01
      c(2, 11) = 0.000000000000D+00
      c(2, 12) = 0.358739081268D+01
      c(2, 13) = 0.203368806130D+01
      c(2, 14) = 0.000000000000D+00
      c(2, 15) = -0.901387663218D+00
      c(2, 16) = 0.000000000000D+00
      c(2, 17) = 0.000000000000D+00
      c(2, 18) = 0.000000000000D+00
      c(2, 19) = 0.000000000000D+00
      c(2, 20) = 0.000000000000D+00
      c(2, 21) = 0.000000000000D+00
      c(3, 1) = -0.000000000000D+00
      c(3, 2) = -0.322176662524D+05
      c(3, 3) = -0.267090835643D+04
      c(3, 4) = -0.373532067350D+04
      c(3, 5) = -0.797121299000D+03
      c(3, 6) = 0.111299540119D+03
      c(3, 7) = 0.299284621116D+04
      c(3, 8) = -0.319333485618D+02
      c(3, 9) = -0.140910103454D+04
      c(3, 10) = -0.848330431187D+01
      c(3, 11) = 0.435025012278D+03
      c(3, 12) = -0.700327539634D+01
      c(3, 13) = 0.545486142353D+01
      c(3, 14) = -0.453346282407D+02
      c(3, 15) = 0.371921027910D+00
      c(3, 16) = 0.464101795796D+01
      c(3, 17) = -0.190069531714D-04
      c(3, 18) = 0.514345336660D-01
      c(3, 19) = -0.431543078188D-02
      c(3, 20) = -0.000000000000D+00
      c(3, 21) = 0.000000000000D+00
      c(4, 1) = 0.000000000000D+00
      c(4, 2) = 0.152897717268D+09
      c(4, 3) = 0.902815532735D+06
      c(4, 4) = 0.191760493084D+07
      c(4, 5) = 0.445372471512D+06
      c(4, 6) = 0.188362654331D+04
      c(4, 7) = -0.383203258784D+06
      c(4, 8) = -0.170027418959D+05
      c(4, 9) = 0.819629330224D+05
      c(4, 10) = 0.560228610945D+04
      c(4, 11) = -0.108203002413D+05
      c(4, 12) = -0.363378668069D+03
      c(4, 13) = -0.260332257619D+03
      c(4, 14) = 0.291068208088D+03
      c(4, 15) = 0.122322834276D+02
      c(4, 16) = -0.132875656470D+02
      c(4, 17) = 0.343356030115D-04
      c(4, 18) = -0.212958640167D-01
      c(4, 19) = 0.389311916174D-03
      c(4, 20) = 0.000000000000D+00
      c(4, 21) = 0.000000000000D+00
      x(1) = 0.000000000000D+00
      x(2) = 0.100000000000D-04
      x(3) = 0.100000000000D-03
      x(4) = 0.100000000000D-02
      x(5) = 0.215443469000D-02
      x(6) = 0.464158883000D-02
      x(7) = 0.100000000000D-01
      x(8) = 0.146779926762D-01
      x(9) = 0.215443469003D-01
      x(10) = 0.316227766017D-01
      x(11) = 0.464158883361D-01
      x(12) = 0.681292069058D-01
      x(13) = 0.100000000000D+00
      x(14) = 0.158489319246D+00
      x(15) = 0.251188643151D+00
      x(16) = 0.398107170553D+00
      x(17) = 0.630957344480D+00
      x(18) = 0.100000000000D+01
      x(19) = 0.261015721568D+01
      x(20) = 0.100000000000D+02
      x(21) = 0.215443469000D+02

    elseif (trim(sigma_param) == 'PBE0_S2') then
      n = 21
      allocate (x(n))
      allocate (c(4, n))

      c(1, 1) = 0.000000000000D+00
      c(1, 2) = 0.000000000000D+00
      c(1, 3) = -0.431405252048D-04
      c(1, 4) = -0.182874853131D-02
      c(1, 5) = -0.852003132762D-02
      c(1, 6) = -0.218177403992D-01
      c(1, 7) = -0.305777654735D-01
      c(1, 8) = -0.870882903969D-02
      c(1, 9) = 0.137878988102D-01
      c(1, 10) = -0.284352007440D-01
      c(1, 11) = -0.798812002431D-01
      c(1, 12) = -0.334010771574D-02
      c(1, 13) = 0.934182748715D-01
      c(1, 14) = 0.204960802253D+00
      c(1, 15) = 0.213204380281D-01
      c(1, 16) = -0.401220283037D-01
      c(1, 17) = 0.321629738336D-01
      c(1, 18) = 0.321618301891D-01
      c(1, 19) = 0.808763912948D-01
      c(1, 20) = 0.000000000000D+00
      c(1, 21) = 0.000000000000D+00
      c(2, 1) = 0.000000000000D+00
      c(2, 2) = 0.000000000000D+00
      c(2, 3) = -0.661870777583D+00
      c(2, 4) = -0.289752912590D+01
      c(2, 5) = -0.558979946652D+01
      c(2, 6) = -0.267765704540D+01
      c(2, 7) = 0.000000000000D+00
      c(2, 8) = 0.389592612611D+01
      c(2, 9) = 0.000000000000D+00
      c(2, 10) = -0.382296397421D+01
      c(2, 11) = 0.000000000000D+00
      c(2, 12) = 0.327772498106D+01
      c(2, 13) = 0.239633724310D+01
      c(2, 14) = 0.000000000000D+00
      c(2, 15) = -0.726304793204D+00
      c(2, 16) = 0.000000000000D+00
      c(2, 17) = 0.000000000000D+00
      c(2, 18) = 0.000000000000D+00
      c(2, 19) = 0.000000000000D+00
      c(2, 20) = 0.000000000000D+00
      c(2, 21) = 0.000000000000D+00
      c(3, 1) = -0.000000000000D+00
      c(3, 2) = -0.862385254713D+04
      c(3, 3) = -0.192306222883D+04
      c(3, 4) = -0.520047462362D+04
      c(3, 5) = -0.877473657666D+03
      c(3, 6) = 0.841408344046D+02
      c(3, 7) = 0.216516760964D+04
      c(3, 8) = 0.296702212913D+03
      c(3, 9) = -0.867733655494D+03
      c(3, 10) = -0.188410055380D+03
      c(3, 11) = 0.336084151111D+03
      c(3, 12) = 0.489746728744D+01
      c(3, 13) = 0.158746877181D+02
      c(3, 14) = -0.562764882273D+02
      c(3, 15) = 0.134759277149D+01
      c(3, 16) = 0.399959778866D+01
      c(3, 17) = -0.251917983154D-04
      c(3, 18) = 0.563694092760D-01
      c(3, 19) = -0.444296223097D-02
      c(3, 20) = -0.000000000000D+00
      c(3, 21) = 0.000000000000D+00
      c(4, 1) = 0.000000000000D+00
      c(4, 2) = 0.366429086790D+08
      c(4, 3) = 0.504466528222D+06
      c(4, 4) = 0.232980923705D+07
      c(4, 5) = 0.392124287301D+06
      c(4, 6) = 0.206173887726D+05
      c(4, 7) = -0.249217659838D+06
      c(4, 8) = -0.563519876566D+05
      c(4, 9) = 0.448530826095D+05
      c(4, 10) = 0.143140667434D+05
      c(4, 11) = -0.800144415404D+04
      c(4, 12) = -0.391685311241D+03
      c(4, 13) = -0.414433988077D+03
      c(4, 14) = 0.376550449117D+03
      c(4, 15) = 0.510124747789D+01
      c(4, 16) = -0.114511339236D+02
      c(4, 17) = 0.455083767664D-04
      c(4, 18) = -0.233390912502D-01
      c(4, 19) = 0.400817027790D-03
      c(4, 20) = 0.000000000000D+00
      c(4, 21) = 0.000000000000D+00
      x(1) = 0.000000000000D+00
      x(2) = 0.100000000000D-04
      x(3) = 0.100000000000D-03
      x(4) = 0.100000000000D-02
      x(5) = 0.215443469000D-02
      x(6) = 0.464158883000D-02
      x(7) = 0.100000000000D-01
      x(8) = 0.146779926762D-01
      x(9) = 0.215443469003D-01
      x(10) = 0.316227766017D-01
      x(11) = 0.464158883361D-01
      x(12) = 0.681292069058D-01
      x(13) = 0.100000000000D+00
      x(14) = 0.158489319246D+00
      x(15) = 0.251188643151D+00
      x(16) = 0.398107170553D+00
      x(17) = 0.630957344480D+00
      x(18) = 0.100000000000D+01
      x(19) = 0.261015721568D+01
      x(20) = 0.100000000000D+02
      x(21) = 0.215443469000D+02

    elseif (trim(sigma_param) == 'PBE_S1') then
      n = 22
      allocate (x(n))
      allocate (c(4, n))

      c(1, 1) = 0.000000000000D+00
      c(1, 2) = 0.000000000000D+00
      c(1, 3) = -0.493740326815D-04
      c(1, 4) = -0.136110637329D-02
      c(1, 5) = -0.506905111755D-02
      c(1, 6) = -0.127411222930D-01
      c(1, 7) = -0.220144968504D-01
      c(1, 8) = -0.239939034695D-01
      c(1, 9) = -0.436386416290D-01
      c(1, 10) = -0.117890214262D+00
      c(1, 11) = -0.141123921668D+00
      c(1, 12) = 0.865524876740D-01
      c(1, 13) = 0.179390274565D+00
      c(1, 14) = 0.269368658116D+00
      c(1, 15) = 0.785040456996D-01
      c(1, 16) = 0.490248637276D-01
      c(1, 17) = -0.111571911794D+00
      c(1, 18) = -0.197712184164D-01
      c(1, 19) = -0.197716870218D-01
      c(1, 20) = -0.372253617253D-01
      c(1, 21) = 0.000000000000D+00
      c(1, 22) = 0.000000000000D+00
      c(2, 1) = 0.000000000000D+00
      c(2, 2) = 0.000000000000D+00
      c(2, 3) = -0.709484897949D+00
      c(2, 4) = -0.197447407686D+01
      c(2, 5) = -0.315478745349D+01
      c(2, 6) = -0.229603163128D+01
      c(2, 7) = -0.670801534786D+00
      c(2, 8) = -0.704199644986D+00
      c(2, 9) = -0.400987325224D+01
      c(2, 10) = -0.269982990241D+01
      c(2, 11) = 0.000000000000D+00
      c(2, 12) = 0.472814414167D+01
      c(2, 13) = 0.207638470052D+01
      c(2, 14) = 0.000000000000D+00
      c(2, 15) = -0.389846972557D+00
      c(2, 16) = -0.298496119087D+00
      c(2, 17) = 0.000000000000D+00
      c(2, 18) = 0.000000000000D+00
      c(2, 19) = -0.601781536636D-06
      c(2, 20) = 0.000000000000D+00
      c(2, 21) = 0.000000000000D+00
      c(2, 22) = 0.000000000000D+00
      c(3, 1) = -0.000000000000D+00
      c(3, 2) = -0.104035132381D+05
      c(3, 3) = -0.108777473624D+04
      c(3, 4) = -0.219328637518D+04
      c(3, 5) = -0.260711341283D+03
      c(3, 6) = 0.132509852177D+02
      c(3, 7) = 0.165970301474D+03
      c(3, 8) = -0.460909893146D+03
      c(3, 9) = -0.112939707971D+04
      c(3, 10) = 0.465035067500D+02
      c(3, 11) = 0.123097490767D+04
      c(3, 12) = -0.876616265219D+02
      c(3, 13) = 0.790484996078D+01
      c(3, 14) = -0.624281400584D+02
      c(3, 15) = 0.324152775194D+01
      c(3, 16) = -0.632212496608D+01
      c(3, 17) = 0.202215332970D+01
      c(3, 18) = -0.308693235932D-06
      c(3, 19) = -0.495067060383D-02
      c(3, 20) = 0.116855980641D-02
      c(3, 21) = -0.000000000000D+00
      c(3, 22) = 0.000000000000D+00
      c(4, 1) = 0.000000000000D+00
      c(4, 2) = 0.478661516427D+08
      c(4, 3) = 0.285187385316D+06
      c(4, 4) = 0.971371823345D+06
      c(4, 5) = 0.116156741398D+06
      c(4, 6) = 0.172191903906D+05
      c(4, 7) = -0.241613612898D+05
      c(4, 8) = 0.213790845631D+05
      c(4, 9) = 0.790063233314D+05
      c(4, 10) = 0.201667888760D+04
      c(4, 11) = -0.344519214370D+05
      c(4, 12) = 0.963471669433D+03
      c(4, 13) = -0.292417702205D+03
      c(4, 14) = 0.433842720035D+03
      c(4, 15) = -0.132982468090D+02
      c(4, 16) = 0.199358142858D+02
      c(4, 17) = -0.365297127483D+01
      c(4, 18) = 0.434041376596D-07
      c(4, 19) = 0.101490424907D-02
      c(4, 20) = -0.796902275213D-04
      c(4, 21) = 0.000000000000D+00
      c(4, 22) = 0.000000000000D+00
      x(1) = 0.000000000000D+00
      x(2) = 0.100000000000D-04
      x(3) = 0.100000000000D-03
      x(4) = 0.100000000000D-02
      x(5) = 0.215443469000D-02
      x(6) = 0.464158883000D-02
      x(7) = 0.100000000000D-01
      x(8) = 0.146779926762D-01
      x(9) = 0.215443469003D-01
      x(10) = 0.316227766017D-01
      x(11) = 0.464158883361D-01
      x(12) = 0.681292069058D-01
      x(13) = 0.100000000000D+00
      x(14) = 0.158489319246D+00
      x(15) = 0.251188643151D+00
      x(16) = 0.398107170553D+00
      x(17) = 0.630957344480D+00
      x(18) = 0.100000000000D+01
      x(19) = 0.237137370566D+01
      x(20) = 0.562341325000D+01
      x(21) = 0.153992652606D+02
      x(22) = 0.316227766000D+02

    elseif (trim(sigma_param) == 'PBE_S2') then
      n = 22
      allocate (x(n))
      allocate (c(4, n))

      c(1, 1) = 0.000000000000D+00
      c(1, 2) = 0.000000000000D+00
      c(1, 3) = -0.156157535801D-03
      c(1, 4) = -0.365199003270D-02
      c(1, 5) = -0.108302033233D-01
      c(1, 6) = -0.203436953346D-01
      c(1, 7) = -0.214330355346D-01
      c(1, 8) = 0.109617244934D-03
      c(1, 9) = 0.813969827075D-02
      c(1, 10) = -0.701367130014D-01
      c(1, 11) = -0.162002361715D+00
      c(1, 12) = 0.337288711362D-01
      c(1, 13) = 0.140348429629D+00
      c(1, 14) = 0.271234417677D+00
      c(1, 15) = 0.780732751240D-01
      c(1, 16) = 0.436066976238D-01
      c(1, 17) = -0.106097689688D+00
      c(1, 18) = -0.133141637069D-01
      c(1, 19) = -0.133143525246D-01
      c(1, 20) = -0.430994711278D-01
      c(1, 21) = 0.000000000000D+00
      c(1, 22) = 0.000000000000D+00
      c(2, 1) = 0.000000000000D+00
      c(2, 2) = 0.000000000000D+00
      c(2, 3) = -0.217211651544D+01
      c(2, 4) = -0.473638379726D+01
      c(2, 5) = -0.487821808504D+01
      c(2, 6) = -0.433631413905D+00
      c(2, 7) = 0.000000000000D+00
      c(2, 8) = 0.193813387881D+01
      c(2, 9) = 0.000000000000D+00
      c(2, 10) = -0.695060290528D+01
      c(2, 11) = 0.000000000000D+00
      c(2, 12) = 0.502541925806D+01
      c(2, 13) = 0.273498669354D+01
      c(2, 14) = 0.000000000000D+00
      c(2, 15) = -0.448708826169D+00
      c(2, 16) = -0.332102918195D+00
      c(2, 17) = 0.000000000000D+00
      c(2, 18) = 0.000000000000D+00
      c(2, 19) = -0.242488141082D-06
      c(2, 20) = 0.000000000000D+00
      c(2, 21) = 0.000000000000D+00
      c(2, 22) = 0.000000000000D+00
      c(3, 1) = -0.000000000000D+00
      c(3, 2) = -0.337014964214D+05
      c(3, 3) = -0.285795351280D+04
      c(3, 4) = -0.372723918347D+04
      c(3, 5) = -0.516689374427D+03
      c(3, 6) = 0.480322803175D+02
      c(3, 7) = 0.253894893657D+04
      c(3, 8) = -0.535684993409D+02
      c(3, 9) = -0.162223464755D+04
      c(3, 10) = -0.319667723139D+03
      c(3, 11) = 0.101401359817D+04
      c(3, 12) = -0.862770702569D+02
      c(3, 13) = 0.212578002151D+02
      c(3, 14) = -0.625949163782D+02
      c(3, 15) = 0.357838438707D+01
      c(3, 16) = -0.543078279308D+01
      c(3, 17) = 0.204380282001D+01
      c(3, 18) = -0.124376927880D-06
      c(3, 19) = -0.844892173480D-02
      c(3, 20) = 0.135295689023D-02
      c(3, 21) = -0.000000000000D+00
      c(3, 22) = 0.000000000000D+00
      c(4, 1) = 0.000000000000D+00
      c(4, 2) = 0.160253203309D+09
      c(4, 3) = 0.106174857663D+07
      c(4, 4) = 0.211694319531D+07
      c(4, 5) = 0.377995031873D+06
      c(4, 6) = -0.941771032564D+03
      c(4, 7) = -0.332306990184D+06
      c(4, 8) = -0.850176312292D+04
      c(4, 9) = 0.844978829514D+05
      c(4, 10) = 0.249933770676D+05
      c(4, 11) = -0.275803550484D+05
      c(4, 12) = 0.105308484492D+04
      c(4, 13) = -0.508788318128D+03
      c(4, 14) = 0.432758845019D+03
      c(4, 15) = -0.144367801061D+02
      c(4, 16) = 0.175904487062D+02
      c(4, 17) = -0.369208055752D+01
      c(4, 18) = 0.174842962107D-07
      c(4, 19) = 0.173203285755D-02
      c(4, 20) = -0.922652326542D-04
      c(4, 21) = 0.000000000000D+00
      c(4, 22) = 0.000000000000D+00
      x(1) = 0.000000000000D+00
      x(2) = 0.100000000000D-04
      x(3) = 0.100000000000D-03
      x(4) = 0.100000000000D-02
      x(5) = 0.215443469000D-02
      x(6) = 0.464158883000D-02
      x(7) = 0.100000000000D-01
      x(8) = 0.146779926762D-01
      x(9) = 0.215443469003D-01
      x(10) = 0.316227766017D-01
      x(11) = 0.464158883361D-01
      x(12) = 0.681292069058D-01
      x(13) = 0.100000000000D+00
      x(14) = 0.158489319246D+00
      x(15) = 0.251188643151D+00
      x(16) = 0.398107170553D+00
      x(17) = 0.630957344480D+00
      x(18) = 0.100000000000D+01
      x(19) = 0.237137370566D+01
      x(20) = 0.562341325000D+01
      x(21) = 0.153992652606D+02
      x(22) = 0.316227766000D+02

    else

      call error('Invalid value for sigma_param: '//sigma_param, &
        'cubic_spline_int')

    end if

    ! determine to which interval s belongs
    m = intervalnum(x, n, s)

    ! evaluate integral
    integral = 0d0
    if (m == 1) then
      integral = 0.5d0*c(2, 1)*s
    end if
    if ((m > 1) .and. (m < n)) then
      h = s-x(m)
      integral = 0.5d0*c(2, 1)*x(2)**2/s &
               +(c(1, m)*h+c(2, m)/2d0*h**2+c(3, m)/3d0*h**3+c(4, m)/4d0*h**4)/s
      do i = 2, m-1
        h = x(i+1)-x(i)
        integral = integral &
                   +(c(1, i)*h+c(2, i)/2d0*h**2+ &
                     c(3, i)/3d0*h**3+c(4, i)/4d0*h**4)/s
      end do
    end if
    if (m == n) then
      integral = 0.5d0*c(2, 1)*x(2)**2/s
      do i = 2, m-1
        h = x(i+1)-x(i)
        integral = integral &
                   +(c(1, i)*h+c(2, i)/2d0*h**2 &
                     +c(3, i)/3d0*h**3+c(4, i)/4d0*h**4)/s
      end do
      integral = integral+c(1, n)*(1d0-x(n)/s)
    end if
    integral = integral*s

    deallocate (x, c)

  contains

    integer function intervalnum(x, n, s) result(inum)
      use iso_fortran_env, only: dp => real64
      implicit none
      integer :: n
      integer :: i
      real(dp), intent(in) :: x(n), s

      if (s <= 0d0) stop 'intervalnum: s should be positive'

      inum = -1
      if (s > x(n)) inum = n
      do i = 1, n-1
        if ((s > x(i)) .and. (s <= x(i+1))) inum = i
      end do

      if (inum == -1) stop 'interval: something was wrong'

    end function intervalnum

  end function cubic_spline_integr
end module acfd_sigma
